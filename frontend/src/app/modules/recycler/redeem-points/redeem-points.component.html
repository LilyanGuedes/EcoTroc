<div class="min-h-screen bg-white">
  <!-- Header Grande com Gradiente Lilás -->
  <div class="pb-8" style="background: linear-gradient(to bottom right, #4B3D6E, #342952)">
    <!-- Top Navigation -->
    <div class="px-4 py-3">
      <div class="flex w-full justify-between items-center">
        <button mat-icon-button (click)="goBack()">
          <mat-icon class="text-white">arrow_back</mat-icon>
        </button>
        <img src="../../../assets/logo.png" alt="Logo EcoTroc" class="h-24" />
        <button mat-icon-button [matMenuTriggerFor]="userMenu" class="!w-12 !h-12">
          <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center font-bold text-sm shadow-lg" style="color: #4B3D6E">
            {{ (currentUser$ | async)?.name?.charAt(0)?.toUpperCase() || 'U' }}
          </div>
        </button>
      </div>
      <mat-menu #userMenu="matMenu">
        <div class="px-4 py-3 border-b bg-gray-50" *ngIf="currentUser$ | async as user">
          <p class="font-semibold text-gray-800">{{ user.name }}</p>
          <p class="text-sm text-gray-600">{{ user.email }}</p>
          <p class="text-xs text-gray-500 mt-1">Reciclador</p>
        </div>
        <button mat-menu-item routerLink="/recycler/home">
          <mat-icon class="text-green-600">home</mat-icon>
          <span>Início</span>
        </button>
        <button mat-menu-item routerLink="/recycler/points">
          <mat-icon class="text-amber-500">stars</mat-icon>
          <span>Meus Pontos</span>
        </button>
        <button mat-menu-item routerLink="/recycler/redeem">
          <mat-icon class="text-blue-600">redeem</mat-icon>
          <span>Resgatar Pontos</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()" class="text-red-600">
          <mat-icon class="text-red-600">logout</mat-icon>
          <span>Sair</span>
        </button>
      </mat-menu>
    </div>

    <!-- Título -->
    <div class="px-6 mt-4 mb-8">
      <h1 class="text-3xl font-bold text-white">Resgatar Pontos</h1>
      <p class="text-sm text-white/90 mt-1">Troque seus pontos por benefícios</p>
    </div>
  </div>

  <!-- Content -->
  <div class="max-w-lg mx-auto px-4 pb-6 -mt-4">
    <div class="bg-white rounded-3xl shadow-lg p-6 border-2 border-green-200">
      <!-- Saldo de Pontos -->
      <div class="bg-green-200 rounded-2xl p-6 mb-6 text-center shadow-lg">
        <p class="text-sm text-green-800 mb-2">Seu saldo disponível</p>
        <h2 class="text-5xl font-bold text-green-900">{{ totalPoints() }}</h2>
        <p class="text-lg text-green-800 mt-1">pontos</p>
      </div>

      <!-- Formulário de Resgate -->
      <form [formGroup]="formGroup" (ngSubmit)="submit()" class="space-y-6">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Quantidade de Pontos</mat-label>
          <input matInput type="number" formControlName="points" placeholder="Digite a quantidade" min="1" [max]="totalPoints()">
          <mat-icon matSuffix>stars</mat-icon>
          <mat-hint>Máximo: {{ totalPoints() }} pontos</mat-hint>
          <mat-error *ngIf="formGroup.get('points')?.hasError('required')">
            Quantidade é obrigatória
          </mat-error>
          <mat-error *ngIf="formGroup.get('points')?.hasError('min')">
            Quantidade mínima é 1 ponto
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Descrição do Resgate</mat-label>
          <textarea matInput formControlName="description" rows="3"
                    placeholder="Ex: Resgate para vale-compras"></textarea>
          <mat-icon matSuffix>description</mat-icon>
          <mat-error *ngIf="formGroup.get('description')?.hasError('required')">
            Descrição é obrigatória
          </mat-error>
        </mat-form-field>

        <!-- Prévia do Resgate -->
        <div *ngIf="(formGroup.get('points')?.value ?? 0) > 0 && formGroup.valid"
             class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-gray-700">Pontos a resgatar:</span>
            <span class="font-bold text-blue-600 text-xl">{{ formGroup.get('points')?.value ?? 0 }}</span>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-600">Saldo restante:</span>
            <span class="font-semibold text-gray-800">{{ totalPoints() - (formGroup.get('points')?.value ?? 0) }} pontos</span>
          </div>
        </div>

        <!-- Botões -->
        <div class="flex gap-4 mt-6">
          <button mat-raised-button color="primary" type="submit"
                  [disabled]="formGroup.invalid || loading() || totalPoints() === 0"
                  class="w-full !bg-green-600 hover:!bg-green-700 !text-white">
            <mat-icon>redeem</mat-icon>
            {{ loading() ? 'Resgatando...' : 'Resgatar Pontos' }}
          </button>
        </div>
      </form>

      <!-- Aviso de Saldo Zero -->
      <div *ngIf="totalPoints() === 0" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4 text-center">
        <mat-icon class="text-yellow-600 text-4xl mb-2">warning</mat-icon>
        <p class="text-yellow-800 font-medium">Você não possui pontos disponíveis para resgate</p>
        <p class="text-yellow-600 text-sm mt-1">Participe de coletas de reciclagem para ganhar pontos!</p>
      </div>
    </div>
  </div>
</div>
